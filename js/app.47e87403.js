(function(e){function t(t){for(var i,s,r=t[0],l=t[1],c=t[2],g=0,d=[];g<r.length;g++)s=r[g],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&d.push(o[s][0]),o[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(d.length)d.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,r=1;r<n.length;r++){var l=n[r];0!==o[l]&&(i=!1)}i&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var i={},o={app:0},a=[];function s(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=i,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/cr-visualisation-2019/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var u=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var i=n("85ec"),o=n.n(i);o.a},"0ab0":function(e,t,n){},"3dac":function(e,t,n){"use strict";var i=n("73b7"),o=n.n(i);o.a},"56d7":function(e,t,n){"use strict";n.r(t);var i,o,a,s,r=n("2b0e"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-container",{staticClass:"visualisation-container",attrs:{fluid:""}},[n("b-row",[n("b-col",[n("h1",[e._v("The ‘dark money’ global empire of the US Christian right")]),n("p",{staticClass:"lead"},[e._v("Since 2007, US Christian right groups, many of them linked to the Trump administration, and notorious for fighting LGBT and women’s reproductive rights, have spent at least $297 million of ‘dark money’ outside the US. Explore their empires of influence.")])])],1),n("b-row",{staticClass:"mb-2"},[n("b-col",[n("b-row",[n("b-col",{staticClass:"filter-buttons"},[n("Filters",{attrs:{regions:e.regions,"selected-regions":e.selectedRegions,organisations:e.organisations,"selected-organisation":e.selectedOrganisation,years:e.years,"selected-years":e.selectedYears,categories:e.categoryColumns,"selected-category":e.selectedCategory},on:{"update:selectedRegions":function(t){e.selectedRegions=t},"update:selected-regions":function(t){e.selectedRegions=t},"update:selectedOrganisation":function(t){e.selectedOrganisation=t},"update:selected-organisation":function(t){e.selectedOrganisation=t},"update:selectedYears":function(t){e.selectedYears=t},"update:selected-years":function(t){e.selectedYears=t},"update:selectedCategory":function(t){e.selectedCategory=t},"update:selected-category":function(t){e.selectedCategory=t}}})],1)],1),e.selectedOrganisation?n("b-row",{staticClass:"mt-2"},[n("b-col",[n("OrganisationInformationBox",{attrs:{"selected-organisation":e.selectedOrganisation,"selected-organisation-text":e.selectedOrganisationText,"organisations-categories":e.organisationsCategories}})],1)],1):e._e(),e.selectedCategory?n("b-row",{staticClass:"mt-2"},[n("b-col",[n("CategoryInformationBox",{attrs:{"selected-category":e.selectedCategory}})],1)],1):e._e()],1)],1),n("b-row",[e.spending.length>0?n("b-col",[n("b-row",{staticClass:"mb-2"},[n("b-col",{attrs:{lg:"6"}},[n("RegionMap",{attrs:{data:e.summarySpendingRegion,"region-colours":e.regionColours,"selected-regions":e.selectedRegions},on:{"update:selectedRegions":function(t){e.selectedRegions=t},"update:selected-regions":function(t){e.selectedRegions=t}}})],1),n("b-col",{attrs:{lg:"6"}},[n("OrganisationSummaryTable",{attrs:{data:e.summarySpendingOrganisation,"selected-organisation":e.selectedOrganisation},on:{"update:selectedOrganisation":function(t){e.selectedOrganisation=t},"update:selected-organisation":function(t){e.selectedOrganisation=t}}})],1)],1),n("b-row",[n("b-col",{attrs:{lg:"6"}},[n("RegionLineChart",{attrs:{data:e.regionLineChartData}})],1),n("b-col",{attrs:{lg:"6"}},[n("RegionPieChart",{attrs:{data:e.summarySpendingRegion,"region-colours":e.regionColours}})],1)],1)],1):e._e()],1)],1)},c=[],u=n("bc3a"),g=n("4d7c"),d=n.n(g),p=n("498a"),h=n("b28b"),m=n("a15b"),f=n("1bbb"),b=(n("f9e3"),n("2dd8"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"filter-buttons"},[n("v-select",{staticClass:"mb-1",attrs:{placeholder:"All organisations",options:e.organisations,label:"Organisation",value:"oD code",reduce:function(e){return e["oD code"]},"get-option-label":e.getOrgLabel},model:{value:e.filterOrganisation,callback:function(t){e.filterOrganisation=t},expression:"filterOrganisation"}}),n("v-select",{staticClass:"mb-1",attrs:{placeholder:"All organisation categories",options:e.categoryKeys},model:{value:e.filterCategory,callback:function(t){e.filterCategory=t},expression:"filterCategory"}}),n("v-select",{staticClass:"mb-1",attrs:{placeholder:"All regions",options:e.regions,multiple:""},model:{value:e.filterRegions,callback:function(t){e.filterRegions=t},expression:"filterRegions"}}),n("v-select",{staticClass:"mb-1",attrs:{placeholder:"All years",options:e.years,multiple:""},model:{value:e.filterYears,callback:function(t){e.filterYears=t},expression:"filterYears"}})],1)}),y=[],C=n("4a7a"),O=n.n(C),v=(n("6dfc"),{components:{vSelect:O.a},props:["regions","selectedRegions","organisations","selectedOrganisation","years","selectedYears","selectedCategories","categories"],data(){return{}},computed:{categoryKeys(){return Object.values(this.categories)},filterRegions:{get:function(){return this.selectedRegions},set:function(e){this.$emit("update:selectedRegions",e)}},filterOrganisation:{get:function(){return this.selectedOrganisation},set:function(e){this.$emit("update:selectedOrganisation",e)}},filterYears:{get:function(){return this.selectedYears},set:function(e){this.$emit("update:selectedYears",e)}},filterCategory:{get:function(){return this.selectedCategory},set:function(e){this.$emit("update:selectedCategory",e)}}},mounted(){},methods:{getOrgLabel(e){return e["Organisation"]}}}),R=v,S=(n("c86a"),n("2877")),x=Object(S["a"])(R,b,y,!1,null,null,null),_=x.exports,D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("l-map",{staticClass:"region-map",attrs:{zoom:e.zoom,center:e.center,options:e.mapControls}},e._l(e.regions,(function(t){return n("RegionMapFeature",{key:t.region,attrs:{"region-colours":e.regionColours,data:e.data,opacity:e.opacity,region:t.region,regionName:t.regionName,selectedRegions:e.filterRegions},on:{"update:selectedRegions":function(t){e.filterRegions=t},"update:selected-regions":function(t){e.filterRegions=t}}})})),1)],1)},T=[],j=n("2699"),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("l-geo-json",{ref:"geoJson",attrs:{geojson:e.geojson,options:e.options,"options-style":e.optionsStyle}})},A=[],N=n("044a"),k={data(){return{zoom:1.2,center:[45,0],geojson:null,mapControls:{zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1,dragging:!1}}},props:["region-colours","data","opacity","region","region-name","selectedRegions"],components:{LGeoJson:N["a"]},computed:{options(){return{onEachFeature:this.onEachFeatureFunction}},filterRegions:{get(){return this.selectedRegions},set:function(e){this.$emit("update:selectedRegions",e)}},onEachFeatureFunction(){return(e,t)=>{t.on("mouseover",e=>{e.target.setStyle({fillOpacity:1})}),t.on("mouseout",e=>{e.target.setStyle({fillOpacity:this.fillOpacity})}),t.on("click",()=>{this.clickRegion()}),t.bindTooltip(this.regionName,{permanent:!1,sticky:!0})}},fillOpacity(){return this.opacity[this.regionName]||0},optionsStyle(){const e=this.regionColours[this.regionName]||"#ffffff";return{fillColor:e,weight:1,opacity:.5,color:"#bbbbbb",fillOpacity:this.fillOpacity}}},methods:{clickRegion(){const e=this.filterRegions.indexOf(this.regionName);e>-1?this.filterRegions.splice(e,1):this.filterRegions.push(this.regionName)},getGeoJSON(){Object(u["get"])(`https://cr-visualisation.github.io/cr-visualisation/map/${this.region}.geojson`).then(e=>{this.geojson=e.data})}},mounted(){this.getGeoJSON()}},$=k,L=Object(S["a"])($,w,A,!1,null,null,null),E=L.exports,Y=(n("6cc5"),{data(){return{zoom:1.2,center:[45,0],regions:[{region:"Africa",regionName:"Africa"},{region:"Asia",regionName:"Asia"},{region:"EurasiaRussia",regionName:"Eurasia/Russia"},{region:"Europe",regionName:"Europe"},{region:"LatinAmerica",regionName:"Latin America"},{region:"MENA",regionName:"Middle East & North Africa"},{region:"NorthAmerica",regionName:"North America (outside the US)"}],mapControls:{zoomControl:!1,attributionControl:!1,scrollWheelZoom:!1,dragging:!1,keyboard:!1,doubleClickZoom:!1,boxZoom:!1,tap:!1,touchZoom:!1}}},props:["region-colours","data","selected-regions"],components:{LMap:j["a"],RegionMapFeature:E},computed:{filterRegions:{get(){return this.selectedRegions},set:function(e){this.$emit("update:selectedRegions",e)}},opacity(){return Object.entries(this.data).reduce((e,t)=>(void 0==t[1].Region||(e[t[1].Region]=t[1].Spending/this.data.Total*3),e),{})}}}),F=Y,M=(n("3dac"),Object(S["a"])(F,D,T,!1,null,null,null)),P=M.exports,B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.data.datasets.length>0?[n("LineChart",{attrs:{data:e.data,options:e.options}}),n("p",{staticClass:"text-muted"},[e._v("Chart shows data by region for available years.")])]:[n("p",{staticClass:"text-muted"},[e._v("No data available for selected filters.")])]],2)},G=[],U=n("1fca"),z={extends:U["a"],props:["data","options"],mounted(){this.renderChart(this.data,this.options)},watch:{data(){this.renderChart(this.data,this.options)}}},I=z,J=Object(S["a"])(I,i,o,!1,null,null,null),Z=J.exports,W={data(){return{stacked:!0,valueLabel:"Total Spend"}},props:["data"],components:{LineChart:Z},computed:{options(){return{maintainAspectRatio:!1,tooltips:{callbacks:{label:(e,t)=>{const n=t.datasets[e.datasetIndex].label,i=e.yLabel.toLocaleString(void 0,{maximumFractionDigits:0}),o=`${this.valueLabel} (${n}): $${i}`;return o}}},scales:{yAxes:[{stacked:this.stacked,ticks:{beginAtZero:!0,callback:function(e){const t=e.toLocaleString(void 0,{maximumFractionDigits:0});return"$"+t}},gridLines:{display:!1}}],xAxes:[{ticks:{callback:function(e){const t=20;return e.length>=t?e.slice(0,e.length).substring(0,t-1).trim()+"...":e}},gridLines:{display:!1}}]}}}}},X=W,V=Object(S["a"])(X,B,G,!1,null,null,null),H=V.exports,K=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("PieChart",{attrs:{data:e.pieChartData,options:e.options}})},q=[],Q={extends:U["b"],props:["data","options"],mounted(){this.renderChart(this.data,this.options)},watch:{data(){this.renderChart(this.data,this.options)}}},ee=Q,te=Object(S["a"])(ee,a,s,!1,null,null,null),ne=te.exports,ie={data(){return{}},props:["data","region-colours"],components:{PieChart:ne},computed:{pieChartData(){const e=Object.values(this.data).reduce((e,t)=>(t.Region&&e.push(t.Spending),e),[]),t=Object.values(this.data).reduce((e,t)=>(t.Region&&e.push(t.Region),e),[]);return{datasets:[{data:e,backgroundColor:t.map(e=>this.regionColours[e])}],labels:t}},options(){return{maintainAspectRatio:!1,tooltips:{callbacks:{label:(e,t)=>{const n=t.labels[e.index],i=t.datasets[0].data[e.index].toLocaleString(void 0,{maximumFractionDigits:0}),o=`Total Spend (${n}): $${i}`;return o}}}}}}},oe=ie,ae=Object(S["a"])(oe,K,q,!1,null,null,null),se=ae.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-table",{staticClass:"small-caps",attrs:{small:"",fields:e.summaryFields,items:e.tableData,"sort-by":"TotalSpend","sort-desc":!0,"sticky-header":"370px"},scopedSlots:e._u([{key:"cell(OrganisationName)",fn:function(t){return[n("a",{attrs:{href:"#"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.setOrganisation(t.item["oDCode"])}}},[e._v(e._s(t.item["OrganisationName"]))])]}}])})},le=[],ce=n("1f1a"),ue=n("29a1");r["a"].use(ce["a"]);var ge={components:{BTable:ue["a"]},props:["data","selected-organisation"],data(){return{summaryFields:[{key:"OrganisationName",sortable:!0},{key:"TotalSpend",label:"Total Spend",sortable:!0,formatter:this.numberFormatter,thClass:"number",tdClass:"number"}]}},computed:{tableData(){return this.data.map(e=>({oDCode:e["oD Code"],OrganisationName:e["Organisation Name"],TotalSpend:e["Total Spend"],_rowVariant:e["_rowVariant"]}))},filterOrganisation:{get:function(){return this.selectedOrganisation},set:function(e){this.$emit("update:selectedOrganisation",e)}}},mounted(){},methods:{setOrganisation(e){this.filterOrganisation==e?this.filterOrganisation=null:this.filterOrganisation=e},numberFormatter(e){if(null==e)return null;const t=e.toLocaleString(void 0,{maximumFractionDigits:0});return"$"+t}}},de=ge,pe=(n("a558"),Object(S["a"])(de,re,le,!1,null,null,null)),he=pe.exports,me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h4",[e._v(e._s(e.selectedOrganisationText))]),e._l(e.categories,(function(t){return n("b-badge",{key:t,staticClass:"mr-1"},[e._v(e._s(t))])})),n("span",{domProps:{innerHTML:e._s(e.organisationDescriptionText)}})],2)},fe=[],be=n("e98b"),ye=n("d4cd"),Ce=n.n(ye),Oe=new Ce.a,ve={data(){return{organisationDescriptionText:null}},props:["selected-organisation","selected-organisation-text","organisations-categories"],components:{BBadge:be["a"]},computed:{categories(){return this.organisationsCategories[this.selectedOrganisation]}},methods:{getOrganisationDescription(){Object(u["get"])(`https://cr-visualisation.github.io/cr-visualisation/organisation-descriptions/${this.selectedOrganisation}.md`).then(e=>{this.organisationDescriptionText=Oe.render(e.data)}).catch(()=>{this.organisationDescriptionText=null})}},mounted(){this.getOrganisationDescription()},watch:{selectedOrganisation(e){null!=e&&this.getOrganisationDescription()}}},Re=ve,Se=Object(S["a"])(Re,me,fe,!1,null,null,null),xe=Se.exports,_e=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h4",[e._v(e._s(e.selectedCategory))]),n("span",{domProps:{innerHTML:e._s(e.categoryDescriptionText)}})])},De=[],Te=new Ce.a,je={data(){return{categoryDescriptionText:null}},props:["selected-category"],components:{},computed:{},methods:{getCategoryDescription(){Object(u["get"])(`https://cr-visualisation.github.io/cr-visualisation/category-summaries/${this.selectedCategory}.md`).then(e=>{this.categoryDescriptionText=Te.render(e.data)}).catch(()=>{this.categoryDescriptionText=null})}},mounted(){this.getCategoryDescription()},watch:{selectedCategory(e){null!=e&&this.getCategoryDescription()}}},we=je,Ae=Object(S["a"])(we,_e,De,!1,null,null,null),Ne=Ae.exports;r["a"].use(p["a"]);var ke={name:"christian-right-visualisation",components:{BCol:h["a"],BRow:m["a"],BContainer:f["a"],Filters:_,RegionMap:P,RegionLineChart:H,RegionPieChart:se,OrganisationSummaryTable:he,OrganisationInformationBox:xe,CategoryInformationBox:Ne},data(){return{regions:["Africa","Asia","Eurasia/Russia","Europe","Latin America","Middle East & North Africa","North America (outside the US)"],organisations:[],years:[2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019],spending:[],selectedOrganisation:null,selectedRegions:[],selectedYears:[],selectedCategory:null,regionColours:{Africa:"#94447c",Asia:"#582a6c","Eurasia/Russia":"#0f1756",Europe:"#164080","Latin America":"#256aa2","Middle East & North Africa":"#3496bb","North America (outside the US)":"#43c2ca"},categoryColumns:{"Trump connections (X = yes)":"Trump connections","WCF partner (X = yes)":"WCF partner","Anti-LGBT (X=yes)":"Anti-LGBT","Anti-abortion (X=yes)":"Anti-abortion"},categoryColours:{"Trump connections":"#94447c","WCF partner":"#582a6c","Anti-LGBT":"#0f1756","Anti-abortion":"#164080"}}},computed:{organisationsCategories(){return this.organisations.reduce((e,t)=>(e[t["oD code"]]=[],Object.entries(this.categoryColumns).forEach(n=>{"X"==t[n[0]]&&e[t["oD code"]].push(n[1])}),e),{})},regionLineChartData(){const e=this.summarySpendingRegionYears.map(e=>({lineTension:0,label:e.Region,backgroundColor:this.regionColours[e.Region],borderColor:this.regionColours[e.Region],fill:!0,data:Object.values(e.Years),spanGaps:!1}));return{labels:this.years,datasets:e}},selectedOrganisationText(){return this.organisations.filter(e=>this.selectedOrganisation==e["oD code"]).map(e=>e["Organisation"]).join("")},summarySpendingOrganisationCategories(){const e={Total:0,...Object.values(this.categoryColumns).reduce((e,t)=>(e[t]={Category:t,Spending:0},e),{})},t=this.filteredSpending.reduce((e,t)=>{const n=this.organisationsCategories[t["oD code"]],i=t["Spending"];return null==i||n.forEach(t=>{e[t].Spending+=i,e["Total"]+=i}),e},e);return t},summarySpendingRegion(){const e=this.filteredSpending.reduce((e,t)=>{const n=t["Region"],i=t["Spending"];return null==i||""==n||(n in e||(e[n]={Region:n,Spending:0}),e[n].Spending+=i,e["Total"]+=i),e},{Total:0});return e},summarySpendingRegionYears(){return Object.values(this.filteredSpending.reduce((e,t)=>{const n=t["Region"],i=t["Year"],o=t["Spending"];return null==o||""==n||(n in e||(e[n]={Region:n,Years:this.years.reduce((e,t)=>(e[t]=null,e),{})}),null==e[n].Years[i]&&(e[n].Years[i]=0),e[n].Years[i]+=o),e},{}))},summarySpendingOrganisation(){return Object.values(this.organisationsFiltersSpending.reduce((e,t)=>(t["oD code"]in e||(e[t["oD code"]]={"oD Code":t["oD code"],"Organisation Name":t["Organisation"],"Total Spend":0},null!=this.selectedOrganisation&&t["oD code"]==this.selectedOrganisation&&(e[t["oD code"]]._rowVariant="warning")),null!=t["Spending"]&&(e[t["oD code"]]["Total Spend"]+=t["Spending"]),e),{}))},organisationsFiltersSpending(){if(0==this.selectedRegions.length&&0==this.selectedYears.length&&null==this.selectedCategory)return this.spending;const e=e=>0==this.selectedRegions.length||this.selectedRegions.includes(e["Region"]),t=e=>0==this.selectedYears.length||this.selectedYears.includes(e["Year"]),n=e=>{if(null==this.selectedCategory)return!0;const t=this.organisationsCategories[e["oD code"]];return void 0!=t&&t.includes(this.selectedCategory)};return this.spending.filter(i=>e(i)&&t(i)&&n(i))},filteredSpending(){if(null==this.selectedOrganisation&&0==this.selectedRegions.length&&0==this.selectedYears.length&&null==this.selectedCategory)return this.spending;const e=e=>null==this.selectedOrganisation||this.selectedOrganisation==e["oD code"],t=e=>0==this.selectedRegions.length||this.selectedRegions.includes(e["Region"]),n=e=>0==this.selectedYears.length||this.selectedYears.includes(e["Year"]),i=e=>{if(null==this.selectedCategory)return!0;const t=this.organisationsCategories[e["oD code"]];return void 0!=t&&t.includes(this.selectedCategory)};return this.spending.filter(o=>e(o)&&t(o)&&n(o)&&i(o))}},mounted(){this.setupData()},methods:{async setupData(){function e(e){const t=parseFloat(e.replace(/,|\$/g,""));return isNaN(t)?null:t}await Object(u["get"])("https://cr-visualisation.github.io/cr-visualisation-2019/organisations.csv").then(e=>{d()().fromString(e.data).then(e=>{this.organisations=e})}),await Object(u["get"])("https://cr-visualisation.github.io/cr-visualisation-2019/spending.csv").then(t=>{d()({colParser:{Year:e=>parseInt(e),Spending:t=>e(t)}}).fromString(t.data).then(e=>{this.spending=e})})}}},$e=ke,Le=(n("034f"),Object(S["a"])($e,l,c,!1,null,null,null)),Ee=Le.exports;r["a"].config.productionTip=!1,new r["a"]({render:e=>e(Ee)}).$mount("#app")},"5cd1":function(e,t,n){},"73b7":function(e,t,n){},"85ec":function(e,t,n){},a558:function(e,t,n){"use strict";var i=n("0ab0"),o=n.n(i);o.a},c32d:function(e,t){if("undefined"===typeof moment){var n=new Error("Cannot find module 'moment'");throw n.code="MODULE_NOT_FOUND",n}e.exports=moment},c86a:function(e,t,n){"use strict";var i=n("5cd1"),o=n.n(i);o.a}});
//# sourceMappingURL=app.47e87403.js.map